<beans:beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://camel.apache.org/schema/spring" 
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:vs2="http://www.vedaxml.com/services/xmlchannel/vsa/v2"
	xsi:schemaLocation="
    	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
       	http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring-2.11.0.xsd">

	<!-- <beans:bean id="stringToDbObject" class="com.veda.icc.esb.utilities.dumper.camel.mongo.StringToDbObject"/> -->

    <beans:import resource="classpath:/META-INF/spring/camel-context/vsa-context.xml"/>
    <beans:import resource="classpath:/META-INF/spring/camel-context/dumper-context.xml"/>
    <beans:import resource="classpath:/META-INF/spring/camel-context/agd-context.xml"/>
    <beans:import resource="classpath:/META-INF/spring/camel-context/idm-context.xml"/>
    <!-- <beans:import resource="classpath:/META-INF/spring/camel-context/ppsr-context.xml"/>
    <beans:import resource="classpath:/META-INF/spring/camel-context/ca-context.xml"/> -->
    <beans:import resource="classpath:/META-INF/spring/camel-context/screech-context.xml"/>
    
	<camelContext id="hackathon-context" useMDCLogging="true" trace="true" streamCache="true" autoStartup="true" useBreadcrumb="true">

		<routeContextRef ref="vsa-context"/>
		<routeContextRef ref="idm-context"/>
		<routeContextRef ref="agd-context"/>
		<!-- 
		<routeContextRef ref="ppsr-context"/>
		<routeContextRef ref="ca-context"/> -->
		<routeContextRef ref="screech-context"/>
		<routeContextRef ref="dumper-context"/>

		<endpoint id="product-request-handler" uri="direct:start" />
		<endpoint id="product-request-handler-http" uri="jetty:http://0.0.0.0:8080/hackathon/services/submit" />
		<endpoint id="product-request-handler-jms" uri="jms:hackathon.gateway" />
		
		<endpoint id="product-orchestrator" uri="direct:product-orchestrator" />

		<endpoint id="vsa-orchestrator" uri="direct:vsa-orchestrator" />
		<endpoint id="vsa-request-dumper" uri="jms:vsa-request-dumper" />
		<endpoint id="vsa-response-dumper" uri="jms:vsa-response-dumper" />
		<endpoint id="vsa-product" uri="direct:vsa-product" />
		
		<endpoint id="agd-orchestrator" uri="direct:agd-orchestrator" />
		<endpoint id="agd-request-dumper" uri="jms:agd-request-dumper" />
		<endpoint id="agd-response-dumper" uri="jms:agd-response-dumper" />
		<endpoint id="agd-product" uri="direct:agd-product" />

		<endpoint id="idm-orchestrator" uri="direct:idm-orchestrator" />
		<endpoint id="idm-request-dumper" uri="jms:idm-request-dumper" />
		<endpoint id="idm-response-dumper" uri="jms:idm-response-dumper" />
		<endpoint id="idm-product" uri="direct:idm-product" />

		<endpoint id="screech-gateway" uri="direct:screech-gateway" />
		<endpoint id="screech-gateway-http" uri="jetty:http://0.0.0.0:8080/hackathon/services/screech" />
		<endpoint id="screech-orchestrator" uri="direct:screech-orchestrator" />
		<endpoint id="screech-response-dumper" uri="jms:screech-response-dumper" />
		<endpoint id="screech-product" uri="direct:screech-product" />

		<endpoint id="dumper-request-handler" uri="jms:dumper-request-handler" />
		<endpoint id="dumper-orchestrator" uri="jms:dumper-orchestrator" />
		
		<dataFormats>
			<xmljson id="xmljson" />
		</dataFormats>
		
		<route id="product-request-handler-http" streamCache="true" >
			<from ref="product-request-handler-http"/>
			<to ref="product-orchestrator" />
		</route>
		
		<route id="product-request-handler">
			<from ref="product-request-handler"/>
			<to ref="product-orchestrator" />
		</route>
		
		<route id="product-orchestrator">
			<from ref="product-orchestrator" />
			<log message="product request: ${body}" loggingLevel="DEBUG"/>
			<to ref="vsa-orchestrator"/>
			<to ref="idm-orchestrator"/>
			<!-- <to ref="bureau-orchestrator"/>
			<to ref="agd-orchestrator"/> -->
		</route>

	</camelContext>

</beans:beans>