<beans:beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://camel.apache.org/schema/spring" xmlns:beans="http://www.springframework.org/schema/beans"
	xsi:schemaLocation="
    	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
       	http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

	<camelContext id="main" useMDCLogging="true" trace="true">
		<propertyPlaceholder id="properties" location="ref:com.veda.icc.esb.xmlchannel.vsa" />

		<!-- <endpoint id="inbox" uri="${vsa-part-a.request-handler.step1}" /> -->
		<endpoint id="inbox" uri="direct:start" />
		<endpoint id="outbox" uri="${vsa-part-a.request-handler.step2}" />
		
		<dataFormats>
			<xmljson id="xmljson" />
		</dataFormats>

		<route id="request-handler">
			<from ref="inbox" />
			<!-- <to ref="outbox" /> -->
			<setHeader headerName="CamelMongoDbCollection"><xpath>/request/collection/text()</xpath></setHeader>
			<log message="saving payload to collection: ${headers.CamelMongoDbCollection}"/>
			<!-- <split streaming="true">
				<tokenize token="part" inheritNamespaceTagName="parts" xml="true" /> -->
			<split>
				<xpath>//part/*</xpath>
				<to uri="jms:queue:order"/>
			</split>
		</route>
		
		<route>
			<from uri="jms:queue:order" />
			<!-- <convertBodyTo type="java.lang.String"/> -->
			<log message="xml part: ${body}"/>
			<marshal ref="xmljson"/>
			<log message="json: ${body}" />
			<convertBodyTo type="java.lang.String"/>
			<to uri="mongodb:myDb?database=test&amp;collection=books&amp;operation=save&amp;dynamicity=true" />
		</route>

	</camelContext>

</beans:beans>